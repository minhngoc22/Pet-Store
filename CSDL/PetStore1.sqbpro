<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="PetStore1.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="3946"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="Categories" custom_title="0" dock_id="1" table="4,10:mainCategories"/><dock_state state="000000ff00000000fd00000001000000020000000000000000fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000ffffffff0000011300ffffff000000000000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings/></tab_browse><tab_sql><sql name="SQL 1*">
CREATE TABLE Employees (
    id INTEGER PRIMARY KEY AUTOINCREMENT,     -- Kh√≥a ch√≠nh, t·ª± ƒë·ªông tƒÉng
    employee_code TEXT UNIQUE,                -- M√£ nh√¢n vi√™n (t·ª± ƒë·ªông sinh)
    full_name TEXT NOT NULL,                  -- H·ªç v√† t√™n nh√¢n vi√™n
    phone TEXT UNIQUE NOT NULL,               -- S·ªë ƒëi·ªán tho·∫°i (kh√¥ng tr√πng l·∫∑p)
    email TEXT UNIQUE,                        -- Email (c√≥ th·ªÉ li√™n k·∫øt v·ªõi Users)
    address TEXT,                             -- ƒê·ªãa ch·ªâ
    salary DECIMAL(10,2) NOT NULL,            -- L∆∞∆°ng
    position TEXT NOT NULL,                   -- Ch·ª©c v·ª• (VD: Nh√¢n vi√™n b√°n h√†ng)
    note TEXT                                 -- Ghi ch√∫
);

-- ‚úÖ Trigger t·∫°o m√£ nh√¢n vi√™n t·ª± ƒë·ªông (EMP-001, EMP-002,...)
CREATE TRIGGER generate_employee_code
AFTER INSERT ON Employees
FOR EACH ROW
BEGIN
    UPDATE Employees 
    SET employee_code = 'EMP-' || printf('%03d', NEW.id)
    WHERE id = NEW.id;
END;
-- üîµ Th√™m d·ªØ li·ªáu v√†o b·∫£ng Employees (Nh√¢n vi√™n)
INSERT INTO Employees (full_name, phone, email, address, salary, position, note) VALUES
('Nguy·ªÖn VƒÉn Nam', '0987123456', 'nam@gmail.com', 'H√† N·ªôi', 15000000, 'Nh√¢n vi√™n b√°n h√†ng', NULL),
('Tr·∫ßn Th·ªã Lan', '0978234567', 'lan@gmail.com', 'TP. HCM', 20000000, 'Qu·∫£n l√Ω', NULL),
('Ho√†ng ƒê·ª©c Minh', '0968345678', 'minh@gmail.com', 'ƒê√† N·∫µng', 18000000, 'Nh√¢n vi√™n kho', NULL),
('L√™ Thanh H∆∞∆°ng', '0958456789', 'huong@gmail.com', 'C·∫ßn Th∆°', 22000000, 'Nh√¢n vi√™n b√°n h√†ng', NULL);

-- üîµ B·∫£ng Users (T√†i kho·∫£n ƒëƒÉng nh·∫≠p)
CREATE TABLE Users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,     -- Kh√≥a ch√≠nh
    user_code TEXT UNIQUE,                    -- M√£ t√†i kho·∫£n (t·ª± ƒë·ªông sinh)
    username TEXT NOT NULL UNIQUE,            -- T√™n ƒëƒÉng nh·∫≠p (duy nh·∫•t)
    password TEXT NOT NULL,                   -- M·∫≠t kh·∫©u
    full_name TEXT NOT NULL,                  -- H·ªç v√† t√™n hi·ªÉn th·ªã
    email TEXT UNIQUE,                        -- Email (duy nh·∫•t, c√≥ th·ªÉ tr√πng Employees.email)
    role TEXT CHECK (role IN ('Admin', 'Nh√¢n vi√™n', 'Kh√°ch H√†ng')) NOT NULL, -- Vai tr√≤
    employee_id INTEGER,                      -- Li√™n k·∫øt nh√¢n vi√™n (n·∫øu l√† nh√¢n vi√™n)
    note TEXT,                                -- Ghi ch√∫
    FOREIGN KEY (employee_id) REFERENCES Employees(id) ON DELETE SET NULL
);

-- ‚úÖ Trigger t·∫°o m√£ t√†i kho·∫£n t·ª± ƒë·ªông (USER-001, USER-002,...)
CREATE TRIGGER generate_user_code
AFTER INSERT ON Users
FOR EACH ROW
BEGIN
    UPDATE Users 
    SET user_code = 'USER-' || printf('%03d', NEW.id)
    WHERE id = NEW.id;
END;
-- üîµ Th√™m d·ªØ li·ªáu v√†o b·∫£ng Users (T√†i kho·∫£n ƒëƒÉng nh·∫≠p)
INSERT INTO Users (username, password, full_name, email, role, employee_id, note) VALUES
('admin1', '123', 'Nguy·ªÖn VƒÉn Nam', 'nam@gmail.com', 'Admin', NULL, NULL),
('staff1', '123', 'L√™ Th·ªã Mai', 'maistaff@gmail.com', 'Nh√¢n vi√™n', 1, NULL),
('admin2', '123', 'Tr·∫ßn Qu·ªëc B·∫£o', 'bao@gmail.com', 'Admin', NULL, NULL),
('staff2', '123', 'ƒê·ªó Ho√†ng Anh', 'anh@gmail.com', 'Nh√¢n vi√™n', 3, NULL),
('khach1', '123', 'Nguy·ªÖn VƒÉn Ho√†ng D≈©ng', 'dung@gmail.com', 'Kh√°ch h√†ng', NULL, NULL),

-- B·∫£ng Customers (Kh√°ch h√†ng)
CREATE TABLE Customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    customer_code TEXT UNIQUE, 
    full_name TEXT NOT NULL, 
    phone TEXT UNIQUE NOT NULL, 
    email TEXT UNIQUE, 
    address TEXT,
	note TEXT
);

CREATE TRIGGER generate_customer_code
AFTER INSERT ON Customers
FOR EACH ROW
BEGIN
    UPDATE Customers 
    SET customer_code = 'CUS-' || printf('%03d', NEW.id)
    WHERE id = NEW.id;
END;

INSERT INTO Customers (full_name, phone, email, address,note) VALUES
('Ph·∫°m Th·ªã H·∫±ng', '0912345678', 'hang@gmail.com', 'H·∫£i Ph√≤ng',NULL),
('Nguy·ªÖn Minh Tu·∫•n', '0923456789', 'tuan@gmail.com', 'B·∫Øc Ninh',NULL),
('L√™ Ho√†ng Anh', '0934567890', 'anh@gmail.com', 'Qu·∫£ng Ninh',NULL),
('ƒê·ªó Thanh B√¨nh', '0945678901', 'binh@gmail.com', 'Nha Trang',NULL);

-- B·∫£ng Suppliers (Nh√† cung c·∫•p)
CREATE TABLE Suppliers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    supplier_code TEXT UNIQUE,
    name TEXT NOT NULL,
    phone TEXT UNIQUE NOT NULL,
    email TEXT UNIQUE,
    address TEXT NOT NULL,
	note TEXT
);

CREATE TRIGGER generate_supplier_code
AFTER INSERT ON Suppliers
FOR EACH ROW
BEGIN
    UPDATE Suppliers 
    SET supplier_code = 'SUP-' || printf('%03d', NEW.id)
    WHERE id = NEW.id;
END;

INSERT INTO Suppliers (name, phone, email, address,note) VALUES
('C√¥ng ty A', '0956789012', 'contact@petfood.com', 'H√† N·ªôi',NULL),
('C√¥ng ty B', '0967890123', 'contact@phukienthucung.com', 'TP. HCM',NULL),
('C√¥ng ty C', '0978901234', 'contact@dungcuchamsoc.com', 'ƒê√† N·∫µng',NULL),
('C√¥ng ty D', '0989012345', 'contact@dochoithucung.com', 'H·∫£i Ph√≤ng',NULL);

-- B·∫£ng Categories (Danh m·ª•c s·∫£n ph·∫©m)
CREATE TABLE Categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    category_name TEXT UNIQUE NOT NULL,
	note TEXT
);

INSERT INTO Categories (category_name,note) VALUES
('Th·ª©c ƒÉn',NULL),
('Ph·ª• ki·ªán',NULL),
('ƒê·ªì ch∆°i',NULL),
('V·ªá sinh',NULL),
('D·ª•ng c·ª• chƒÉm s√≥c',NULL);


-- 6Ô∏è‚É£ B·∫£ng Products (S·∫£n ph·∫©m)
-- 6Ô∏è‚É£ B·∫£ng Products (S·∫£n ph·∫©m) v·ªõi supplier TEXT thay v√¨ supplier_id INTEGER
CREATE TABLE Products (
    id TEXT PRIMARY KEY, 
    product_name TEXT NOT NULL, 
    category_id INTEGER NOT NULL, 
    price DECIMAL(10,2) NOT NULL, 
    stock_quantity INTEGER NOT NULL DEFAULT 0, 
    supplier TEXT, -- L∆∞u tr·ª±c ti·∫øp t√™n nh√† cung c·∫•p
    image_path TEXT,
	note TEXT,
    FOREIGN KEY (category_id) REFERENCES Categories(id) ON DELETE CASCADE
	
);

-- Ch√®n d·ªØ li·ªáu m·∫´u v·ªõi t√™n nh√† cung c·∫•p thay v√¨ ID
INSERT INTO Products (id, product_name, category_id, price, stock_quantity, supplier, image_path,note) 
VALUES 
('P001', 'Th·ª©c ƒÉn cho ch√≥', (SELECT id FROM Categories WHERE category_name='Th·ª©c ƒÉn'), 150000, 100, 'C√¥ng ty A', 'E:\HK6\DoAN\DoAn\hinhanh\cat_food.jpg',NULL),
('P002', 'C√°t v·ªá sinh cho m√®o', (SELECT id FROM Categories WHERE category_name='V·ªá sinh'), 50000, 50, 'C√¥ng ty B', 'E:\HK6\DoAN\DoAn\hinhanh\cat_sand.png',NULL),
('P003', 'B√†n c√†o m√≥ng cho m√®o', (SELECT id FROM Categories WHERE category_name='Ph·ª• ki·ªán'), 250000, 30, 'C√¥ng ty C',NULL,NULL),
('P004', 'S·ªØa t·∫Øm cho ch√≥', (SELECT id FROM Categories WHERE category_name='D·ª•ng c·ª• chƒÉm s√≥c'), 180000, 40, 'C√¥ng ty D' ,NULL,NULL);
-- B·∫£ng Orders (ƒê∆°n h√†ng)
CREATE TABLE Orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_code TEXT UNIQUE,
    customer_id INTEGER NOT NULL,
    employee_id INTEGER NOT NULL,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
    status TEXT CHECK (status IN ('ƒêang x·ª≠ l√Ω', 'Ho√†n th√†nh', 'ƒêang giao', 'ƒê√£ h·ªßy')) NOT NULL DEFAULT 'ƒêang x·ª≠ l√Ω',
    payment TEXT CHECK (payment IN ('Ch∆∞a thanh to√°n', 'ƒê√£ thanh to√°n')) NOT NULL DEFAULT 'Ch∆∞a thanh to√°n',
	note TEXT ,
    FOREIGN KEY (customer_id) REFERENCES Customers(id) ON DELETE CASCADE,
    FOREIGN KEY (employee_id) REFERENCES Employees(id) ON DELETE SET NULL
);

CREATE TRIGGER generate_order_code
AFTER INSERT ON Orders
FOR EACH ROW
BEGIN
    UPDATE Orders 
    SET order_code = 'ORD-' || strftime('%Y%m', 'now') || '-' || printf('%03d', NEW.id)
    WHERE id = NEW.id;
END;

INSERT INTO Orders (customer_id, employee_id, total_amount, status, payment,note) VALUES
(1, 1, 300000, 'Ho√†n th√†nh', 'ƒê√£ thanh to√°n',NULL),
(2, 2, 400000, 'ƒêang giao', 'Ch∆∞a thanh to√°n',NULL),
(3, 3, 250000, 'ƒêang x·ª≠ l√Ω', 'Ch∆∞a thanh to√°n',NULL),
(4, 4, 500000, 'Ho√†n th√†nh', 'ƒê√£ thanh to√°n',NULL),
(4, 2, 200000, 'ƒê√£ h·ªßy', 'Ch∆∞a thanh to√°n', NULL);

-- B·∫£ng OrdersDetails (Chi ti·∫øt ƒë∆°n h√†ng)
CREATE TABLE OrdersDetails (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    order_id INTEGER NOT NULL, 
    product_id TEXT NOT NULL, 
    quantity INTEGER NOT NULL, 
    unit_price DECIMAL(10,2) NOT NULL, 
    total_price DECIMAL(10,2) GENERATED ALWAYS AS (quantity * unit_price) STORED, 
	note TEXT,
    FOREIGN KEY (order_id) REFERENCES Orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES Products(id) ON DELETE CASCADE
);

-- TRIGGER: C·∫≠p nh·∫≠t t·ªïng ti·ªÅn ƒë∆°n h√†ng khi th√™m s·∫£n ph·∫©m
CREATE TRIGGER update_total_amount_after_insert
AFTER INSERT ON OrdersDetails
FOR EACH ROW
BEGIN
    UPDATE Orders
    SET total_amount = (SELECT SUM(total_price) FROM OrdersDetails WHERE order_id = NEW.order_id)
    WHERE id = NEW.order_id;
END;

-- TRIGGER: C·∫≠p nh·∫≠t t·ªïng ti·ªÅn ƒë∆°n h√†ng khi x√≥a s·∫£n ph·∫©m
CREATE TRIGGER update_total_amount_after_delete
AFTER DELETE ON OrdersDetails
FOR EACH ROW
BEGIN
    UPDATE Orders
    SET total_amount = COALESCE((SELECT SUM(total_price) FROM OrdersDetails WHERE order_id = OLD.order_id), 0)
    WHERE id = OLD.order_id;
END;

-- Th√™m d·ªØ li·ªáu m·∫´u cho OrdersDetails
INSERT INTO OrdersDetails (order_id, product_id, quantity, unit_price,note) VALUES
(1, 'P001', 2, 150000,NULL),
(1, 'P002', 1, 250000,NULL),
(2, 'P003', 3, 80000,NULL),
(3, 'P004', 2, 120000,NULL);</sql><current_tab id="0"/></tab_sql></sqlb_project>
